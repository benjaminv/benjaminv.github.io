<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Laravel Database Raw SQL, Query Builder and Eloquent ORM</title>
  <meta name="description" content="[Contents]">
  <link rel="canonical" href="http://localhost:4000/2021/08/07/laravel-db-raw-SQL-query-builder-and-eloquent/">
  <link rel="alternate" type="application/rss+xml" title="Ben's IT Diary" href="http://localhost:4000/feed.xml">

  <style type="text/css">
    
    /*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{font-size:2em;margin:0.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}*,*:before,*:after{box-sizing:border-box}.wrapper{padding:25px 0}@media only screen and (min-width: 64.063em){.wrapper{padding:32px 0;margin-left:250px}}.off-canvas-container{display:flex;min-height:100vh;flex-direction:column}.off-canvas-container .wrapper{flex:1 0 auto}.icon{vertical-align:bottom}@font-face{font-family:'Born';src:url("/fonts/Born/Born.eot");src:url("/fonts/Born/Born.woff2") format("woff2"),url("/fonts/Born/Born.woff") format("woff"),url("/fonts/Born/Born.ttf") format("truetype"),url("/fonts/Born/Born.svg#Born") format("svg"),url("/fonts/Born/Born.eot?#iefix") format("embedded-opentype");font-weight:normal;font-style:normal}table{width:100%;max-width:100%}table th,table td{padding:16px;text-align:left;vertical-align:top;border-top:1px solid #ECF0F1;font-weight:400}table thead th{font-weight:700;text-transform:uppercase;font-size:14px;vertical-align:bottom;border-bottom:2px solid #ECF0F1}table tbody+tbody{border-top:2px solid #ECF0F1}body{color:#222;background-color:#fff;font-size:19px;font-weight:300;font-family:Born,Georgia,serif;line-height:32px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1,h2,h3,h4,h5,h6{font-family:Born,Georgia,serif;font-size:19px;font-weight:300;margin:0 0 25px}@media only screen and (max-width: 40em){h1,h2,h3,h4,h5,h6{font-size:16px}}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{text-decoration:none}.post-content h1{font-size:32px}.post-content h2{font-size:28px}.post-content h3{font-size:26px}.post-content h4{font-size:22px}.post-content h5{font-size:19px}.post-content li{margin:0 0 12.5px}p{margin:0 0 32px}p.font-medium{margin:0 0 25px}p.font-small{margin:0 0 22px}p.font-tiny{margin:0 0 19px}@media only screen and (max-width: 40em){p{margin:0 0 25px}}blockquote{margin:0;padding:0 64px 0 64px;font-style:italic}@media only screen and (max-width: 40em){blockquote{padding:0 44px 0 44px}}hr{border:0;height:1px;background-color:#ECF0F1;margin:0 0 32px}@media only screen and (max-width: 40em){hr{margin:0 0 25px}}ul,ol{margin:0 0 32px}ul ul,ul ol,ol ul,ol ol{margin:0}@media only screen and (max-width: 40em){ul,ol{margin:0 0 25px}}a{color:#222;transition:.4s}a:visited{color:#222}a:hover{color:#7E7E7E}a:active{color:#222}a.custom{text-decoration:none}.box{padding-bottom:25px;margin-bottom:25px;overflow:hidden;border-bottom:1px solid #ECF0F1}@media only screen and (min-width: 64.063em){.box{padding-bottom:32px;margin-bottom:32px}}.box--news-letter input[type='email']{margin-bottom:0}.box__icon{float:left;width:32px;margin-right:10.6666666667px}.box__title{margin:0;font-weight:300;line-height:25px}@media only screen and (min-width: 40.063em){.box__body{overflow:hidden}}.box__text{margin-top:11px;margin-bottom:0;font-size:14px;line-height:22px}.box a{text-decoration:none}.box--author,.box--news-letter{padding:25px;background-color:#FAFAFA}@media only screen and (min-width: 64.063em){.box--author,.box--news-letter{padding:32px}}img,iframe{display:block}img{height:auto;max-width:100%}.post-content img,.post-content iframe,.post-content .fluid-width-video-wrapper,.post-content .twitter-tweet{margin-bottom:25px !important}@media only screen and (max-width: 40em){.post-content img,.post-content iframe,.post-content .fluid-width-video-wrapper,.post-content .twitter-tweet{margin-bottom:22px}}.post-content p img{margin-bottom:0}.post__tags{margin-bottom:28px;font-size:14px}.post__tags a{padding:3px 11px;margin:4px 8px 4px 0;display:inline-block;font-size:12px;line-height:22px;color:#7E7E7E;border:1px solid #ECF0F1;text-decoration:none;transition:.4s}.post__tags a:before{content:"#";padding-right:2px}.post__tags a:hover{color:#222;border-color:#222}pre,code{font-family:Courier,monospace;background-color:#FAFAFA;line-height:22px}pre{overflow:auto;margin-top:0;margin-bottom:32px;padding:32px;font-size:16px;white-space:pre-wrap;word-wrap:break-word}@media only screen and (max-width: 40em){pre{margin-bottom:22px;padding:25px}}p code{padding:3px 6px}.row{margin:0 auto;padding-left:13px;padding-right:13px;max-width:1100px}.row:before,.row:after{display:table;clear:both;content:" "}.row .row{padding:0;margin-right:-13px;margin-left:-13px}@media only screen and (min-width: 64.063em){.row .row{margin-right:-16px;margin-left:-16px}}@media only screen and (min-width: 64.063em){.row{padding-left:16px;padding-right:16px}}.row--full{max-width:100%}.column{position:relative;float:left;padding-right:13px;padding-left:13px;width:100%}@media only screen and (min-width: 64.063em){.column{padding-right:16px;padding-left:16px}}.column--center{float:none;margin:0 auto}@media only screen{.small-1{width:8.3333333333%}.small-2{width:16.6666666667%}.small-3{width:25%}.small-4{width:33.3333333333%}.small-5{width:41.6666666667%}.small-6{width:50%}.small-7{width:58.3333333333%}.small-8{width:66.6666666667%}.small-9{width:75%}.small-10{width:83.3333333333%}.small-11{width:91.6666666667%}.small-12{width:100%}}@media only screen and (min-width: 40.063em){.medium-1{width:8.3333333333%}.medium-2{width:16.6666666667%}.medium-3{width:25%}.medium-4{width:33.3333333333%}.medium-5{width:41.6666666667%}.medium-6{width:50%}.medium-7{width:58.3333333333%}.medium-8{width:66.6666666667%}.medium-9{width:75%}.medium-10{width:83.3333333333%}.medium-11{width:91.6666666667%}.medium-12{width:100%}}@media only screen and (min-width: 64.063em){.large-1{width:8.3333333333%}.large-2{width:16.6666666667%}.large-3{width:25%}.large-4{width:33.3333333333%}.large-5{width:41.6666666667%}.large-6{width:50%}.large-7{width:58.3333333333%}.large-8{width:66.6666666667%}.large-9{width:75%}.large-10{width:83.3333333333%}.large-11{width:91.6666666667%}.large-12{width:100%}}input[type='text'],input[type='tel'],input[type='number'],input[type='email'],textarea{width:100%;max-width:100%;margin-bottom:0;display:inline-block;border:1px solid #222;margin-bottom:8px;padding:6px 11px;font-family:Born,Georgia,serif;font-size:14px;line-height:25px;letter-spacing:1px;outline:none;background:transparent;appearance:none;border-radius:0;transition:.4s}@media only screen and (min-width: 64.063em){input[type='text'],input[type='tel'],input[type='number'],input[type='email'],textarea{padding:8px 16px}}input[type='text']:focus,input[type='tel']:focus,input[type='number']:focus,input[type='email']:focus,textarea:focus{border:1px solid #7E7E7E}.button{display:inline-block;text-align:center;padding:8px 16px;font-family:Born,Georgia,serif;font-size:12px;line-height:25px;letter-spacing:1px;border:0;border-radius:0;text-decoration:none;color:#fff;background-color:#222;transition:.4s}.button--expand{width:100%}.button:active,.button:focus,.button:hover{color:#fff;background-color:#7E7E7E}.separator{position:relative;margin:32px auto;text-align:center;text-transform:uppercase;font-size:14px;font-weight:300;letter-spacing:1px}.separator:after{position:absolute;right:0;left:0;top:50%;content:"";border-bottom:1px solid #ECF0F1}.separator__title{position:relative;z-index:1;padding:0px 16px;background:#FFF none repeat scroll 0% 0%}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.icon{position:relative;display:inline-block;width:25px;height:25px;overflow:hidden;fill:currentColor}.icon__cnt{width:100%;height:100%;background:inherit;fill:inherit;pointer-events:none;transform:translateX(0);-ms-transform:translate(0.5px, -0.3px)}.icon--m{width:50px;height:50px}.icon--l{width:100px;height:100px}.icon--xl{width:150px;height:150px}.icon--xxl{width:200px;height:200px}.icon__spinner{position:absolute;top:0;left:0;width:100%;height:100%}.icon--ei-spinner .icon__spinner,.icon--ei-spinner-2 .icon__spinner{-webkit-animation:spin 1s steps(12) infinite;animation:spin 1s steps(12) infinite}.icon--ei-spinner-3 .icon__spinner{-webkit-animation:spin 1.5s linear infinite;animation:spin 1.5s linear infinite}.icon--ei-sc-facebook{fill:#3b5998}.icon--ei-sc-github{fill:#333}.icon--ei-sc-google-plus{fill:#dd4b39}.icon--ei-sc-instagram{fill:#3f729b}.icon--ei-sc-linkedin{fill:#0976b4}.icon--ei-sc-odnoklassniki{fill:#ed812b}.icon--ei-sc-skype{fill:#00aff0}.icon--ei-sc-soundcloud{fill:#f80}.icon--ei-sc-tumblr{fill:#35465c}.icon--ei-sc-twitter{fill:#55acee}.icon--ei-sc-vimeo{fill:#1ab7ea}.icon--ei-sc-vk{fill:#45668e}.icon--ei-sc-youtube{fill:#e52d27}.icon--ei-sc-pinterest{fill:#bd081c}.icon--ei-sc-telegram{fill:#0088cc}.post-card{margin-bottom:25px;padding-bottom:25px;border-bottom:1px solid #ECF0F1;text-align:center}.post-card__image{margin-bottom:16px;transition:.4s}@media only screen and (max-width: 40em){.post-card__image{margin-bottom:13px}}.post-card__title{line-height:25px;margin-top:0;margin-bottom:0}.post-card__title a{display:block;border-bottom:none;transition:.4s}.post-card__title a:hover{color:#a60505}.post-card__meta{margin-bottom:8px;font-size:12px;line-height:22px;color:#7E7E7E}.post-card__meta a{color:#7E7E7E;text-decoration:none}.post-card:hover .post-card__image{opacity:0.9}.post-card:hover .post-card__title a{color:#a60505}.post-card--featured__icon{position:absolute;bottom:8px;left:8px;fill:#fff}@media only screen and (min-width: 64.063em){.post-card{margin-bottom:32px;padding-bottom:32px}}.post-list{display:flex;flex-wrap:wrap;display:-webkit-flex;-webkit-flex-wrap:wrap}.post-list .post-card-wrap{display:flex;display:-webkit-flex}.post-list .post-card{width:100%}.share-list{display:flex;display:-webkit-box;display:-ms-flexbox;padding:0;border:1px solid #ECF0F1;margin-bottom:32px;line-height:22px;list-style:none}.share-list li{flex:1;-ms-flex:1;-webkit-box-flex:1;text-align:center;margin:0;border-right:1px solid #ECF0F1}.share-list li:last-child{border-right:0}.share-list__link{display:block;padding:8px;font-size:14px;transition:.4s}.share-list__link:hover{background-color:#FAFAFA}.share-list__link:hover .share-list__icon--twitter{fill:#55acee}.share-list__link:hover .share-list__icon--facebook{fill:#3b5998}.share-list__link:hover .share-list__icon--google{fill:#dc4e41}.share-list__icon{fill:#222}@media only screen and (max-width: 40em){.share-list{margin-bottom:25px}}.FlexEmbed{display:block;overflow:hidden;position:relative}.FlexEmbed:before{content:"";display:block;width:100%}.FlexEmbed--3by1:before{padding-bottom:33.33333%}.FlexEmbed--2by1:before{padding-bottom:50%}.FlexEmbed--16by9:before{padding-bottom:56.25%}.FlexEmbed--4by3:before{padding-bottom:75%}.CoverImage{max-height:650px;max-width:100%;background-repeat:no-repeat;background-size:cover}.highlight{margin:0;background:#fff}.highlighter-rouge .highlight{background:#FAFAFA}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:teal}.highlight .nb{color:#0086B3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:teal}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}@media only screen and (min-width: 64.063em){.navigation{margin-bottom:25px;padding-bottom:25px;border-bottom:1px solid #DADFE1}}.navigation li{display:block;margin-bottom:8px;font-size:14px;line-height:25px}.navigation li:last-child{margin-bottom:0}@media only screen and (max-width: 64em){.navigation li{display:block;text-align:center;margin-right:0;line-height:32px}}.navigation a{transition:.4s;text-decoration:none}@media only screen and (max-width: 64em){.navigation a{display:block;padding-top:8px;padding-bottom:8px;border-bottom:1px solid #ECF0F1}}@media only screen and (max-width: 64em){.navigation{margin-bottom:8px}}.social-nav{margin-bottom:25px;list-style:none;padding:0}.social-nav .icon{vertical-align:-moz-middle-with-baseline;vertical-align:-webkit-baseline-middle;fill:#222;transition:.4s}.social-nav .icon:hover{fill:#7E7E7E}.social-nav li{display:inline-block}@media only screen and (max-width: 64em){.social-nav{text-align:center}}.pagination{clear:both;font-size:12px;line-height:25px}.pagination span,.pagination .icon{position:relative}.pagination .newer-posts{float:left;text-align:left}.pagination .newer-posts span,.pagination .newer-posts .icon{left:-8.3333333333px}.pagination .older-posts{float:right;text-align:right}.pagination .older-posts span,.pagination .older-posts .icon{right:-8.3333333333px}.pagination a{text-decoration:none;text-transform:uppercase;letter-spacing:.2em;transition:.4s}.post-navigation{flex-grow:1}.post-navigation .post-card{border-bottom:0;margin-bottom:0}.post-navigation:before{position:absolute;z-index:1;content:"";top:16px;padding:0 16px;font-size:14px;color:#7E7E7E;background-color:rgba(255,255,255,0.9);transition:.4s}.post-navigation.prev:before{left:32px;content:"Previous Story"}.post-navigation.next:before{right:32px;content:"Next Story"}.post-navigation:hover:before{background-color:#fff}.sidebar{padding:13px 0;line-height:25px}@media only screen and (max-width: 64em){.sidebar{background-color:#fff;border-bottom:1px solid #ECF0F1}}@media only screen and (min-width: 64.063em){.sidebar{position:fixed;top:0;left:0;width:250px;height:100%;background-color:#FAFAFA;padding:32px 0;display:flex;align-items:center;text-align:center}}.sidebar__logo{margin-bottom:8px}.sidebar__logo a{transition:.4s;text-decoration:none;letter-spacing:1px}.sidebar__logo a:hover{color:#7E7E7E}@media only screen and (max-width: 64em){.sidebar__logo{margin-bottom:0;line-height:25px}}.sidebar__description{margin-bottom:25px;padding-bottom:25px;border-bottom:1px solid #DADFE1}@media only screen and (max-width: 64em){.sidebar__description{display:none}}.sidebar__bottom{text-align:center}@media only screen and (min-width: 64.063em){.sidebar__bottom{position:absolute;right:0;left:0;bottom:32px}}@media only screen and (max-width: 64em){.home-template .sidebar{border-bottom:1px solid #ECF0F1}}.off-canvas-toggle{display:none}@media only screen and (max-width: 64em){.off-canvas-toggle{float:right;display:block;margin-right:8px;font-size:14px;cursor:pointer}}@media only screen and (max-width: 64em){html,body{overflow-x:hidden}.off-canvas-content{position:fixed;top:0;right:0;width:250px;height:100%;background-color:#fff;border-left:1px solid #ECF0F1;transform:translate3d(250px, 0, 0)}.off-canvas-container{transition:all .4s cubic-bezier(0.16, 0.63, 0.45, 0.98)}.off-canvas-container.is-active{transform:translate3d(-250px, 0, 0)}}.search-form-container{position:fixed;top:0;right:0;bottom:0;left:0;z-index:101;white-space:nowrap;background:#fff;opacity:0;visibility:hidden;transition:all .4s ease-in-out;transform:translate(0px, -100%) scale(0, 0)}.search-form-container__close{position:absolute;top:32px;right:32px;width:32px;height:32px;cursor:pointer;text-align:center}.search-form-container__close .icon{vertical-align:text-top;transition:.4s;fill:#222}.search-form-container__close .icon:hover{fill:#7E7E7E;transform:rotate(90deg)}@media only screen and (max-width: 40em){.search-form-container__close{top:16px;right:16px}}.search-form-container.is-active{opacity:1;visibility:visible;transform:translate(0px, 0px) scale(1, 1)}.search-form{margin-bottom:16px}.search-form__field{padding:0;width:100%;outline:none;font-size:38px;line-height:64px;border:0;border-bottom:1px solid #ECF0F1}@media only screen and (max-width: 40em){.search-form__field{font-size:28px;line-height:44px}}.search-form__field:focus{border:0;border-bottom:1px solid #ECF0F1}.search-form__submit{display:none}.search-form__fieldset{border:0;margin-top:64px;padding:0}.search-results{display:none;height:80vh;overflow:auto;white-space:normal}.search-results .heading{margin-right:16px;margin-bottom:16px;color:#7E7E7E}.search-results__item{margin-bottom:16px;margin-right:16px;padding-bottom:16px;border-bottom:1px solid #ECF0F1}.search-results__item__title{display:block;text-decoration:none;font-size:16px;line-height:25px}.search-results__item__date{font-size:12px;line-height:22px;color:#7E7E7E}.author-image{float:left;margin:0;margin-right:25px}.author-image .img{height:96px;width:96px;background-position:center;background-size:cover;border-radius:100%}@media only screen and (max-width: 40em){.author-image .img{height:64px;width:64px}}@media only screen and (min-width: 64.063em){.author-image{margin-right:32px}}.author-meta{text-indent:-1px}.author-meta .icon{fill:#222;transition:.4s}.author-meta a .icon:hover{fill:#7E7E7E}.post{position:relative;padding:32px 0;margin:0 auto;background:#fff}@media only screen and (min-width: 40.063em){.post{top:-64px;padding:32px}}@media only screen and (min-width: 64.063em){.post{top:-96px;padding:64px;-webkit-box-shadow:3px 3px 5px 0px #BDBDBD;box-shadow:3px 3px 5px 0px #BDBDBD}}.post__header{margin-bottom:13px;text-align:center}.post__title{margin-bottom:13px;font-size:32px;line-height:50px}@media only screen and (max-width: 40em){.post__title{font-size:19px;line-height:32px}}.post__date{font-size:14px;line-height:22px;color:#7E7E7E}.post-content{margin-top:25px}.grey-bg{background-color:#FAFAFA}.no-bullets,.list-bare{list-style:none}.bullets-inside{list-style:inside}.list-bare{margin:0;padding:0}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}.text-justify{text-align:justify}.inline{display:inline}.block{display:block}.inline-block{display:inline-block}.hide{display:none}.left{float:left}.right{float:right}.hidden{border:0 none;clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;padding:0;position:absolute !important;width:1px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.light{font-weight:300}.regular{font-weight:400}.bold{font-weight:700}.italic{font-style:italic}.cap{text-transform:capitalize}.uppercase{text-transform:uppercase}.ell{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.font-base{font-size:19px}.font-medium{font-size:16px;line-height:25px}.font-small{font-size:14px;line-height:22px}.font-tiny{font-size:12px;line-height:19px}

  </style>

  <script>
    var base_url = "";
  </script>
</head>

<body>

  <!-- Google Analytics Code -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZLBSQLPH2B"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-ZLBSQLPH2B');
</script>

  <div class="off-canvas-container">
    <div class="sidebar">
  <div class="row">

    <div class="column small-10 large-12">
      <h1 class="sidebar__logo logo"><a href="/">Ben's IT Diary</a></h1>
      <div class="sidebar__description font-small">Keep it neat</div>
    </div>

    <label class="off-canvas-toggle"><span data-icon="ei-navicon" data-size="s"></span></label>

    <div class="off-canvas-content">

      <div class="column small-12 large-12">
        <nav class="navigation">
          <ul class="list-bare text-center">
            
              
            
              
                
                  <li>
                    <a class="page-link" href="/about.html">About</a>
                  </li>
                
              
            
              
                
              
            
              
                
              
            
              
                
                  <li>
                    <a class="page-link" href="/privacy.html">Privacy Policy</a>
                  </li>
                
              
            
              
                
              
            
            <li><a class="subscribe-button icon-feed" href="/feed.xml">RSS</a></li>
          </ul>
        </nav>
      </div>

      <div class="column small-12 large-12">
        <ul class="social-nav social-icons">
          
          <li>
            <a href="http://www.github.com/benjaminv" target="_blank">
              <span data-icon="ei-sc-github" data-size="s"></span>
            </a>
          </li>
          

          
          <li>
            <a href="http://www.twitter.com/benuoa" target="_blank">
              <span data-icon="ei-sc-twitter" data-size="s"></span>
            </a>
          </li>
          

          
          <li>
            <a href="mailto:i@seedme.app" target="_blank">
              <span data-icon="ei-envelope" data-size="s"></span>
            </a>
          </li>
          

          <li>
            <a class="toggle-search-button" href="#">
              <span data-icon="ei-search" data-size="s"></span>
            </a>
          </li>
        </ul>
      </div>

      <div class="sidebar__bottom">
        <div class="column small-12 large-12">
          <div class="font-tiny">
            &copy; 2022 Ben's IT Diary
          </div>
        </div>
      </div>

    </div> <!-- off-canvas-content -->

  </div>
</div>

<div class="search-form-container">

  <form class="search-form">
    <fieldset class="search-form__fieldset">
      <div class="row">
        <div class="column column--center large-8">
          <input class="search-form__field" placeholder="Type to search" autofocus>
          <input class="search-form__submit" type="submit" value="search">
        </div>
      </div>
    </fieldset>
  </form>

  <div class="row">
    <div class="column column--center large-8">
      <div class="search-results"></div>
    </div>
  </div>

  <div class="close-search-button search-form-container__close">
    <span data-icon="ei-close" data-size="s"></span>
  </div>

</div>

    



<div class="wrapper">
  <div class="row row--full">

    <div class="column column--center medium-12 large-12">
      <div class="grey-bg CoverImage FlexEmbed FlexEmbed--16by9" style="background-image: url(/images/posts/laravel-db-raw-sql-query-builder-eloquent-orm.png)"></div>
    </div>

    <div class="column column--center medium-12 large-10">
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

        
          <meta itemprop="og:image" content="http://localhost:4000/images/posts/laravel-db-raw-sql-query-builder-eloquent-orm.png">
        

        <header class="post__header">
          <h2 class="post__title" itemprop="name headline">Laravel Database Raw SQL, Query Builder and Eloquent ORM</h2>
          <time class="post__date" datetime="2021-08-07T00:00:00+10:00" itemprop="datePublished">Aug 7, 2021</time>
        </header>

        <div class="post-content" itemprop="articleBody">
          <p>[Contents]</p>

<ul>
  <li><a href="#1-raw-sql-via-db-facade">1. Raw SQL via DB Facade</a></li>
  <li><a href="#2-chaining-with-the-query-builder">2. Chaining with the Query Builder</a>
    <ul>
      <li><a href="#21-constraining-methods">2.1. Constraining Methods</a>
        <ul>
          <li><a href="#211-examples">2.1.1. Examples</a>
            <ul>
              <li><a href="#2111-select">2.1.1.1. <code class="language-plaintext highlighter-rouge">select()</code></a></li>
              <li><a href="#2112-where">2.1.1.2. <code class="language-plaintext highlighter-rouge">where()</code></a></li>
              <li><a href="#2113-orwhere">2.1.1.3. <code class="language-plaintext highlighter-rouge">orWhere()</code></a>
                <ul>
                  <li><a href="#21131-caution-of-using-multiple-orwhere">2.1.1.3.1. Caution of using multiple <code class="language-plaintext highlighter-rouge">orWhere()</code></a></li>
                </ul>
              </li>
              <li><a href="#2114-wherebetween">2.1.1.4. <code class="language-plaintext highlighter-rouge">whereBetween()</code></a></li>
              <li><a href="#2115-wherein">2.1.1.5. <code class="language-plaintext highlighter-rouge">whereIn()</code></a></li>
              <li><a href="#2116-whereraw">2.1.1.6. <code class="language-plaintext highlighter-rouge">whereRaw()</code></a></li>
              <li><a href="#2117-whereexist">2.1.1.7. <code class="language-plaintext highlighter-rouge">whereExist()</code></a></li>
              <li><a href="#2118-distinct">2.1.1.8. <code class="language-plaintext highlighter-rouge">distinct()</code></a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#22-modifying-methods">2.2. Modifying Methods</a>
        <ul>
          <li><a href="#221-examples">2.2.1. Examples</a>
            <ul>
              <li><a href="#2211-orderbycolname-direction">2.2.1.1. <code class="language-plaintext highlighter-rouge">orderBy(colName, direction)</code></a></li>
              <li><a href="#2212-groupby">2.2.1.2. <code class="language-plaintext highlighter-rouge">groupBy()</code></a></li>
              <li><a href="#2213-skip-and-take">2.2.1.3. <code class="language-plaintext highlighter-rouge">skip()</code> and <code class="language-plaintext highlighter-rouge">take()</code></a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#23-conditional-methods">2.3. Conditional Methods</a>
        <ul>
          <li><a href="#231-examples">2.3.1. Examples</a>
            <ul>
              <li><a href="#2311-when">2.3.1.1. <code class="language-plaintext highlighter-rouge">when()</code></a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#24-endingreturning-methods">2.4. Ending/Returning Methods</a>
        <ul>
          <li><a href="#241-examples">2.4.1. Examples</a>
            <ul>
              <li><a href="#2411-get">2.4.1.1. <code class="language-plaintext highlighter-rouge">get()</code></a></li>
              <li><a href="#2412-first-and-firstorfail">2.4.1.2. <code class="language-plaintext highlighter-rouge">first()</code> and <code class="language-plaintext highlighter-rouge">firstOrFail()</code></a></li>
              <li><a href="#2413-findid-and-findorfailid">2.4.1.3. <code class="language-plaintext highlighter-rouge">find(id)</code> and <code class="language-plaintext highlighter-rouge">findOrFail(id)</code></a></li>
              <li><a href="#2414-value">2.4.1.4. <code class="language-plaintext highlighter-rouge">value()</code></a></li>
              <li><a href="#2415-count">2.4.1.5. <code class="language-plaintext highlighter-rouge">count()</code></a></li>
              <li><a href="#2416-min-and-max">2.4.1.6. <code class="language-plaintext highlighter-rouge">min()</code> and <code class="language-plaintext highlighter-rouge">max()</code></a></li>
              <li><a href="#2417-sum-and-avg">2.4.1.7. <code class="language-plaintext highlighter-rouge">sum()</code> and <code class="language-plaintext highlighter-rouge">avg()</code></a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#25-raw-queries-and-raw-query-inside-query-builder">2.5. Raw Queries and Raw Query inside Query Builder</a>
        <ul>
          <li><a href="#251-raw-query">2.5.1. Raw Query</a></li>
          <li><a href="#252-raw-query-inside-query-builder">2.5.2. Raw Query inside Query Builder</a></li>
        </ul>
      </li>
      <li><a href="#26-join-clauses">2.6. Join Clauses</a></li>
      <li><a href="#27-unions">2.7. Unions</a></li>
      <li><a href="#28-insertupdatedeletetransaction">2.8. Insert/Update/Delete/Transaction</a></li>
    </ul>
  </li>
  <li><a href="#3-eloquent-orm">3. Eloquent ORM</a>
    <ul>
      <li><a href="#31-eloquent-methods">3.1. Eloquent Methods</a>
        <ul>
          <li><a href="#311-retrieving-data">3.1.1. Retrieving Data</a></li>
          <li><a href="#312-inserts-and-updates">3.1.2. Inserts and Updates</a></li>
          <li><a href="#313-delection">3.1.3. Delection</a></li>
        </ul>
      </li>
      <li><a href="#32-query-scopes">3.2. Query Scopes</a>
        <ul>
          <li><a href="#321-global-scope">3.2.1. Global Scope</a></li>
          <li><a href="#322-local-scope">3.2.2. Local Scope</a></li>
        </ul>
      </li>
      <li><a href="#33-mutators--casting">3.3. Mutators &amp; Casting</a>
        <ul>
          <li><a href="#331-accessors-mutators">3.3.1. Accessors, Mutators</a></li>
          <li><a href="#332-attribute-casting">3.3.2. Attribute Casting</a></li>
          <li><a href="#333-custom-casts">3.3.3. Custom Casts</a></li>
        </ul>
      </li>
      <li><a href="#34-eloquent-collections">3.4. Eloquent Collections</a>
        <ul>
          <li><a href="#341-collection-methos">3.4.1. Collection Methos</a></li>
        </ul>
      </li>
      <li><a href="#35-eloquent-serialization">3.5. Eloquent Serialization</a>
        <ul>
          <li><a href="#351-to-arrays">3.5.1. To Arrays</a></li>
          <li><a href="#352-to-json">3.5.2. To JSON</a></li>
        </ul>
      </li>
      <li><a href="#36-eloquent-relationships">3.6. Eloquent Relationships</a></li>
      <li><a href="#37-manipulation-of-relationships">3.7. Manipulation of Relationships</a></li>
      <li><a href="#38-eager-loading">3.8. Eager Loading</a>
        <ul>
          <li><a href="#381-constraining-eager-loads">3.8.1. Constraining Eager Loads</a></li>
          <li><a href="#382-lazy-eager-loading">3.8.2. Lazy Eager Loading</a></li>
          <li><a href="#383-preventing-lazy-loading">3.8.3. Preventing Lazy Loading</a></li>
        </ul>
      </li>
      <li><a href="#39-eloquent-events">3.9. Eloquent Events</a></li>
      <li><a href="#310-test">3.10. Test</a></li>
    </ul>
  </li>
  <li><a href="#4-reference">4. Reference</a></li>
</ul>

<p>As we all agree Laravel is created using php and support most (if not all) native php methods. This is also true when comes to database operations in Laravel.</p>

<p>In this post, I will demostrate the differences between using row SQL, chained Query Builder as well Eloquent ORM when play with database in Laravel.</p>

<h2 id="1-raw-sql-via-db-facade">1. Raw SQL via DB Facade</h2>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// UserController</span>
<span class="kn">use</span> <span class="no">Illuminate\Support\Facade\DB</span><span class="p">;</span>
<span class="mf">...</span>

<span class="c1">// Basic statement</span>
<span class="no">DB</span><span class="o">::</span><span class="nf">statement</span><span class="p">(</span><span class="s1">'drop table users'</span><span class="p">);</span>

<span class="c1">// Raw select, and parameter binding</span>
<span class="no">DB</span><span class="o">::</span><span class="nf">select</span><span class="p">(</span><span class="s1">'select * from contacts where validated = ?'</span><span class="p">,</span> <span class="p">[</span><span class="kc">true</span><span class="p">]);</span>

<span class="c1">// Select using the fluent builder</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>

<span class="c1">// Joins and other complex calls</span>
<span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">join</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$join</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$join</span><span class="o">-&gt;</span><span class="nf">on</span><span class="p">(</span><span class="s1">'users.id'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'contacts.user_id'</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'contacts.type'</span><span class="p">,</span> <span class="s1">'donor'</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>
<p>It is possible to make any raw call to database using the <code class="language-plaintext highlighter-rouge">DB</code> facade with <code class="language-plaintext highlighter-rouge">statement()</code> method, <code class="language-plaintext highlighter-rouge">DB::statement('SQL statement here')</code></p>

<p>But there are also specific methods for various common actions: <code class="language-plaintext highlighter-rouge">select()</code>, <code class="language-plaintext highlighter-rouge">insert()</code>, <code class="language-plaintext highlighter-rouge">update()</code>, and <code class="language-plaintext highlighter-rouge">delete()</code>.</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Raw <code class="language-plaintext highlighter-rouge">select</code></td>
      <td><code class="language-plaintext highlighter-rouge">DB::select('select * from users');</code></td>
    </tr>
    <tr>
      <td>Raw <code class="language-plaintext highlighter-rouge">insert</code></td>
      <td><code class="language-plaintext highlighter-rouge">DB::insert('insert into contacts (name, email) values (?, ?)', ['sally', 'sally@me.com']); </code></td>
    </tr>
    <tr>
      <td>Raw <code class="language-plaintext highlighter-rouge">update</code></td>
      <td><code class="language-plaintext highlighter-rouge">DB::update('update contacts set status = ? where id = ?', ['donor', $id]);</code></td>
    </tr>
    <tr>
      <td>Raw <code class="language-plaintext highlighter-rouge">delete</code></td>
      <td><code class="language-plaintext highlighter-rouge">DB::delete('delete from contacts where archived = ?', [true]);</code></td>
    </tr>
  </tbody>
</table>

<h2 id="2-chaining-with-the-query-builder">2. Chaining with the Query Builder</h2>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// UserController</span>
<span class="kn">use</span> <span class="no">Illuminate\Support\Facade\DB</span><span class="p">;</span>
<span class="mf">...</span>
<span class="nv">$usersOfType</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="nv">$type</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<p>Let’s take a look at what methods the query builder allows us to chain. The methods can be split up into four categories: <strong>constraining methods, modifying methods, conditional methods, and ending/returning methods</strong>.</p>

<table>
  <thead>
    <tr>
      <th>constraining methods</th>
      <th>modifying methods</th>
      <th>conditional methods</th>
      <th>ending/returning methods</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">select()</code></td>
      <td><code class="language-plaintext highlighter-rouge">orderBy(colName, direction)</code></td>
      <td><code class="language-plaintext highlighter-rouge">when()</code></td>
      <td><code class="language-plaintext highlighter-rouge">get()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">where()</code></td>
      <td><code class="language-plaintext highlighter-rouge">groupBy()</code> and <code class="language-plaintext highlighter-rouge">having()</code> or <code class="language-plaintext highlighter-rouge">havingRaw()</code></td>
      <td><code class="language-plaintext highlighter-rouge">unless()</code></td>
      <td><code class="language-plaintext highlighter-rouge">first()</code> and <code class="language-plaintext highlighter-rouge">firstOrFail()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">orWhere()</code></td>
      <td><code class="language-plaintext highlighter-rouge">skip()</code> and <code class="language-plaintext highlighter-rouge">take()</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">find(id)</code> and <code class="language-plaintext highlighter-rouge">findOrFail(id)</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereBetween(colName, [low, high])</code></td>
      <td><code class="language-plaintext highlighter-rouge">latest(colName)</code> and <code class="language-plaintext highlighter-rouge">oldest(colName)</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">value()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereIn(colName, [1, 2, 3])</code><br /><code class="language-plaintext highlighter-rouge">whereInRaw(colName, [1, 2, 3])</code><br /><code class="language-plaintext highlighter-rouge">whereIntegerInRaw(colName, [1, 2, 3])</code></td>
      <td><code class="language-plaintext highlighter-rouge">inRandomOrder()</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">count()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereNull(colName) and whereNotNull(colName)</code></td>
      <td> </td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">min()</code> and <code class="language-plaintext highlighter-rouge">max()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereRaw()</code></td>
      <td> </td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">sum()</code> and <code class="language-plaintext highlighter-rouge">avg()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereExists()</code></td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">distinct()</code></td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>Further than the listed, custom methods exist for making raw statement - for example, <code class="language-plaintext highlighter-rouge">select()</code> has a <code class="language-plaintext highlighter-rouge">selectRaw()</code> counterpart that allows you to pass in a string for the query builder to place after the <code class="language-plaintext highlighter-rouge">WHERE</code> statement.</p>

<p>One can however pass in the result of a DB::raw() call to almost any method in the query builder to achieve the same result.</p>

<p>Other SQL native methods like <a href="https://laravel.com/docs/8.x/queries#joins">join and union</a> are also made possible in Query Builder.</p>

<table>
  <thead>
    <tr>
      <th>Raw Methods</th>
      <th>Join Methods</th>
      <th>Union Methods</th>
      <th>Insert/Update/Delete</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">selectRaw()</code></td>
      <td><code class="language-plaintext highlighter-rouge">join()</code></td>
      <td><code class="language-plaintext highlighter-rouge">union()</code></td>
      <td><code class="language-plaintext highlighter-rouge">insert()</code> / <code class="language-plaintext highlighter-rouge">insertOrIgnore()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereRaw()</code> / <code class="language-plaintext highlighter-rouge">orWhereRaw()</code></td>
      <td><code class="language-plaintext highlighter-rouge">leftJoin()</code> / <code class="language-plaintext highlighter-rouge">rightJoin()</code></td>
      <td><code class="language-plaintext highlighter-rouge">unionAll()</code></td>
      <td><code class="language-plaintext highlighter-rouge">upsert()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">havingRaw()</code> / <code class="language-plaintext highlighter-rouge">orHavingRaw()</code></td>
      <td><code class="language-plaintext highlighter-rouge">crossJoin()</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">update()</code><br /><code class="language-plaintext highlighter-rouge">increment()</code><br /><code class="language-plaintext highlighter-rouge">decrement()</code><br />json <code class="language-plaintext highlighter-rouge">update()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">orderBy()</code></td>
      <td>Advanced Join Clauses</td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">delete()</code><br /><code class="language-plaintext highlighter-rouge">truncate()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">groupBy()</code></td>
      <td><code class="language-plaintext highlighter-rouge">joinSub()</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">transaction()</code></td>
    </tr>
  </tbody>
</table>

<h3 id="21-constraining-methods">2.1. Constraining Methods</h3>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Funciton</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">select()</code></td>
      <td>Allows you to choose which columns you’re selecting</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">where()</code></td>
      <td>Allows you to limit the scope of what’s being returned using <code class="language-plaintext highlighter-rouge">WHERE</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">orWhere()</code></td>
      <td>Creates simple <code class="language-plaintext highlighter-rouge">OR WHERE</code> statements</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereBetween(colName, [low, high])</code></td>
      <td>Allows you to scope a query to return only rows where a column is between two values (inclusive of the two values)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereIn(colName, [1, 2, 3])</code><br /><code class="language-plaintext highlighter-rouge">whereInRaw(colName, [1, 2, 3])</code><br /><code class="language-plaintext highlighter-rouge">whereIntegerInRaw(colName, [1, 2, 3])</code></td>
      <td>Allows you to scope a query to return only rows where a column value is in an explicitly provided list of options</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereNull(colName) and whereNotNull(colName)</code></td>
      <td>Allow you to select only rows where a given column <code class="language-plaintext highlighter-rouge">is NULL</code> or <code class="language-plaintext highlighter-rouge">is NOT NULL</code>, respectively</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereRaw()</code></td>
      <td>Allows you to pass in a raw, unescaped string to be added after the <code class="language-plaintext highlighter-rouge">WHERE</code> statement</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">whereExists()</code></td>
      <td>Allows you to select only rows that, when passed into a provided subquery, return at least one row</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">distinct()</code></td>
      <td>Selects only rows where the selected data is unique when compared to the other rows in the returned data</td>
    </tr>
  </tbody>
</table>

<h4 id="211-examples">2.1.1. Examples</h4>
<h5 id="2111-select">2.1.1.1. <code class="language-plaintext highlighter-rouge">select()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// select() method</span>
<span class="nv">$emails</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">select</span><span class="p">(</span><span class="s1">'email'</span><span class="p">,</span> <span class="s1">'email2 as second_email'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
<span class="c1">// Or</span>
<span class="nv">$emails</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">select</span><span class="p">(</span><span class="s1">'email'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">addSelect</span><span class="p">(</span><span class="s1">'email2 as second_email'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h5 id="2112-where">2.1.1.2. <code class="language-plaintext highlighter-rouge">where()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// where() method</span>
<span class="nv">$newVips</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'vip'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'created_at'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="nf">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">subDay</span><span class="p">());</span>
<span class="c1">// Or</span>
<span class="nv">$newVips</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">'vip'</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'created_at'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="nf">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">subDay</span><span class="p">()],</span>
<span class="p">]);</span>
</code></pre></div></div>

<h5 id="2113-orwhere">2.1.1.3. <code class="language-plaintext highlighter-rouge">orWhere()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// orWhere() method with a closure</span>
<span class="nv">$contacts</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'vip'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">orWhere</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'created_at'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="nf">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">subDay</span><span class="p">())</span>
            <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'trial'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h6 id="21131-caution-of-using-multiple-orwhere">2.1.1.3.1. Caution of using multiple <code class="language-plaintext highlighter-rouge">orWhere()</code></h6>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$canEdit</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">orWhere</span><span class="p">(</span><span class="s1">'plan'</span><span class="p">,</span> <span class="s1">'premium'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'is_plan_owner'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>

<span class="c1">// is equivalent to </span>

<span class="no">SELECT</span> <span class="o">*</span> <span class="no">FROM</span> <span class="n">users</span>
    <span class="no">WHERE</span> <span class="n">admin</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">OR</span> <span class="n">plan</span> <span class="o">=</span> <span class="s1">'premium'</span>
    <span class="k">AND</span> <span class="n">is_plan_owner</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>
<p>and,</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$canEdit</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">orWhere</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'plan'</span><span class="p">,</span> <span class="s1">'premium'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'is_plan_owner'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>

<span class="c1">// is equivalent to</span>

<span class="no">SELECT</span> <span class="o">*</span> <span class="no">FROM</span> <span class="n">users</span>
    <span class="no">WHERE</span> <span class="n">admin</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">OR</span> <span class="p">(</span><span class="n">plan</span> <span class="o">=</span> <span class="s1">'premium'</span> <span class="k">AND</span> <span class="n">is_plan_owner</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<h5 id="2114-wherebetween">2.1.1.4. <code class="language-plaintext highlighter-rouge">whereBetween()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// whereBetween() method</span>
<span class="nv">$mediumDrinks</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'drinks'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">whereBetween</span><span class="p">(</span><span class="s1">'size'</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h5 id="2115-wherein">2.1.1.5. <code class="language-plaintext highlighter-rouge">whereIn()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// whereIn() method</span>
<span class="nv">$closeBy</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">whereIn</span><span class="p">(</span><span class="s1">'state'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'FL'</span><span class="p">,</span> <span class="s1">'GA'</span><span class="p">,</span> <span class="s1">'AL'</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h5 id="2116-whereraw">2.1.1.6. <code class="language-plaintext highlighter-rouge">whereRaw()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// whereRaw() method</span>
<span class="c1">// BEWARE OF SQL INJECTION! ALWAYS AVOID!</span>
<span class="nv">$goofs</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">whereRaw</span><span class="p">(</span><span class="s1">'id = 12345'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">()</span>
</code></pre></div></div>

<h5 id="2117-whereexist">2.1.1.7. <code class="language-plaintext highlighter-rouge">whereExist()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// whereExist() method</span>
<span class="nv">$commenters</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">whereExists</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">select</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">from</span><span class="p">(</span><span class="s1">'comments'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">whereRaw</span><span class="p">(</span><span class="s1">'comments.user_id = users.id'</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
<span class="c1">// get those users who have left at least one comment</span>
</code></pre></div></div>

<h5 id="2118-distinct">2.1.1.8. <code class="language-plaintext highlighter-rouge">distinct()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// distinct() method</span>
<span class="nv">$lastNames</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">select</span><span class="p">(</span><span class="s1">'city'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">distinct</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="22-modifying-methods">2.2. Modifying Methods</h3>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">orderBy(colName, direction)</code></td>
      <td>Orders the results. The second parameter may be either <code class="language-plaintext highlighter-rouge">asc</code> (the default, ascending order) or <code class="language-plaintext highlighter-rouge">desc</code> (descending order)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">groupBy()</code> and <code class="language-plaintext highlighter-rouge">having()</code> or <code class="language-plaintext highlighter-rouge">havingRaw()</code></td>
      <td>Groups your results by a column. Optionally, <code class="language-plaintext highlighter-rouge">having()</code> and <code class="language-plaintext highlighter-rouge">havingRaw()</code> allow you to filter your results based on properties of the groups</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">skip()</code> and <code class="language-plaintext highlighter-rouge">take()</code></td>
      <td>Most often used for pagination, these allow you to define how many rows to return and how many to skip before starting the return</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">latest(colName)</code> and <code class="language-plaintext highlighter-rouge">oldest(colName)</code></td>
      <td>Sort by the passed column (or created_at if no column name is passed) in descending (<code class="language-plaintext highlighter-rouge">latest()</code>) or ascending (<code class="language-plaintext highlighter-rouge">oldest()</code>) order</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">inRandomOrder()</code></td>
      <td>Sorts the result randomly</td>
    </tr>
  </tbody>
</table>

<h4 id="221-examples">2.2.1. Examples</h4>

<h5 id="2211-orderbycolname-direction">2.2.1.1. <code class="language-plaintext highlighter-rouge">orderBy(colName, direction)</code></h5>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// orderBy() method</span>
<span class="nv">$contacts</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">orderBy</span><span class="p">(</span><span class="s1">'last_name'</span><span class="p">,</span> <span class="s1">'asc'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h5 id="2212-groupby">2.2.1.2. <code class="language-plaintext highlighter-rouge">groupBy()</code></h5>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// groupBy() method</span>
<span class="nv">$populousCities</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">groupBy</span><span class="p">(</span><span class="s1">'city'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">havingRaw</span><span class="p">(</span><span class="s1">'count(contact_id) &gt; 30'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h5 id="2213-skip-and-take">2.2.1.3. <code class="language-plaintext highlighter-rouge">skip()</code> and <code class="language-plaintext highlighter-rouge">take()</code></h5>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// skip() and take()</span>
<span class="c1">// returns rows 31-40</span>
<span class="nv">$page4</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">skip</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="23-conditional-methods">2.3. Conditional Methods</h3>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">when()</code></td>
      <td>Given a truthy first parameter, applies the query modification contained in the closure; given a falsy first parameter, it does nothing</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">unless()</code></td>
      <td>The exact inverse of when(). If the first parameter is falsy, it will run the second closure</td>
    </tr>
  </tbody>
</table>

<h4 id="231-examples">2.3.1. Examples</h4>

<h5 id="2311-when">2.3.1.1. <code class="language-plaintext highlighter-rouge">when()</code></h5>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$status</span> <span class="o">=</span> <span class="nf">request</span><span class="p">(</span><span class="s1">'status'</span><span class="p">);</span> <span class="c1">// Defaults to null if not set</span>

<span class="nv">$posts</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">when</span><span class="p">(</span><span class="nv">$status</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$status</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>

<span class="c1">// Or</span>
<span class="nv">$posts</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">when</span><span class="p">(</span><span class="nv">$ignoreDrafts</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'draft'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<p>You can also pass a third parameter, another closure, which will only be applied if the first parameter is falsy.</p>

<h3 id="24-endingreturning-methods">2.4. Ending/Returning Methods</h3>
<p>These methods stop the query chain and trigger the execution of the SQL query. Without one of these at the end of the query chain, your return will always just be an instance of the <strong><code class="language-plaintext highlighter-rouge">query builder</code></strong></p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">get()</code></td>
      <td>Gets all results for the built query</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">first()</code> and <code class="language-plaintext highlighter-rouge">firstOrFail()</code></td>
      <td>Get only the first result—like <code class="language-plaintext highlighter-rouge">get()</code>, but with a <code class="language-plaintext highlighter-rouge">LIMIT 1</code> added</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">find(id)</code> and <code class="language-plaintext highlighter-rouge">findOrFail(id)</code></td>
      <td>Like <code class="language-plaintext highlighter-rouge">first()</code>, but you pass in an ID value that corresponds to the primary key to look up</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">value()</code></td>
      <td>Plucks just the value from a single field from the <em>first</em> row</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">count()</code></td>
      <td>Returns an integer count of all of the matching results</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">min()</code> and <code class="language-plaintext highlighter-rouge">max()</code></td>
      <td>Return the minimum or maximum value of a particular column</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sum()</code> and <code class="language-plaintext highlighter-rouge">avg()</code></td>
      <td>Return the sum or average of all of the values in a particular column</td>
    </tr>
  </tbody>
</table>

<h4 id="241-examples">2.4.1. Examples</h4>
<h5 id="2411-get">2.4.1.1. <code class="language-plaintext highlighter-rouge">get()</code></h5>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// get() method</span>
<span class="nv">$contacts</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
<span class="nv">$vipContacts</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'vip'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>

<h5 id="2412-first-and-firstorfail">2.4.1.2. <code class="language-plaintext highlighter-rouge">first()</code> and <code class="language-plaintext highlighter-rouge">firstOrFail()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// first() method</span>
<span class="nv">$newestContact</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">orderBy</span><span class="p">(</span><span class="s1">'created_at'</span><span class="p">,</span> <span class="s1">'desc'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">first</span><span class="p">();</span>
</code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">first()</code> fails silently if there are no results, whereas <code class="language-plaintext highlighter-rouge">firstOrFail()</code> will throw an exception.</p>
</blockquote>

<p><em>If you pass an array of column names to either method, it will return the data for just those columns instead of all columns.</em></p>

<h5 id="2413-findid-and-findorfailid">2.4.1.3. <code class="language-plaintext highlighter-rouge">find(id)</code> and <code class="language-plaintext highlighter-rouge">findOrFail(id)</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// find() method</span>
<span class="nv">$contactFive</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">find</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">find()</code> fails <em>silently</em> if a row with that ID doesn’t exist, while <code class="language-plaintext highlighter-rouge">findOrFail()</code> will throw an exception.</p>
</blockquote>

<h5 id="2414-value">2.4.1.4. <code class="language-plaintext highlighter-rouge">value()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// value() method</span>
<span class="nv">$newestContactEmail</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">orderBy</span><span class="p">(</span><span class="s1">'created_at'</span><span class="p">,</span> <span class="s1">'desc'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">value</span><span class="p">(</span><span class="s1">'email'</span><span class="p">);</span>
</code></pre></div></div>

<h5 id="2415-count">2.4.1.5. <code class="language-plaintext highlighter-rouge">count()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// count() method</span>
<span class="nv">$countVips</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'contacts'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'vip'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nb">count</span><span class="p">();</span>
</code></pre></div></div>

<h5 id="2416-min-and-max">2.4.1.6. <code class="language-plaintext highlighter-rouge">min()</code> and <code class="language-plaintext highlighter-rouge">max()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// max() method</span>
<span class="nv">$highestCost</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'orders'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">max</span><span class="p">(</span><span class="s1">'amount'</span><span class="p">);</span>
</code></pre></div></div>

<h5 id="2417-sum-and-avg">2.4.1.7. <code class="language-plaintext highlighter-rouge">sum()</code> and <code class="language-plaintext highlighter-rouge">avg()</code></h5>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// avg() method</span>
<span class="nv">$averageCost</span> <span class="o">=</span> <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'orders'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="s1">'completed'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">avg</span><span class="p">(</span><span class="s1">'amount'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="25-raw-queries-and-raw-query-inside-query-builder">2.5. Raw Queries and Raw Query inside Query Builder</h3>

<h4 id="251-raw-query">2.5.1. Raw Query</h4>

<h4 id="252-raw-query-inside-query-builder">2.5.2. Raw Query inside Query Builder</h4>

<h3 id="26-join-clauses">2.6. Join Clauses</h3>

<h3 id="27-unions">2.7. Unions</h3>

<h3 id="28-insertupdatedeletetransaction">2.8. Insert/Update/Delete/Transaction</h3>

<h2 id="3-eloquent-orm">3. Eloquent ORM</h2>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ContactController</span>
<span class="kn">namespace</span> <span class="nn">App</span><span class="p">;</span>
<span class="mf">...</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="mf">...</span>
<span class="kd">class</span> <span class="nc">Contact</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="mf">...</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">show</span><span class="p">(</span><span class="nv">$contactId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'contacts.show'</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="nf">with</span><span class="p">(</span><span class="s1">'contact'</span><span class="p">,</span> <span class="nc">Contact</span><span class="o">::</span><span class="nf">findOrFail</span><span class="p">(</span><span class="nv">$contactId</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="31-eloquent-methods">3.1. Eloquent Methods</h3>

<h4 id="311-retrieving-data">3.1.1. Retrieving Data</h4>

<h4 id="312-inserts-and-updates">3.1.2. Inserts and Updates</h4>

<h4 id="313-delection">3.1.3. Delection</h4>

<h3 id="32-query-scopes">3.2. Query Scopes</h3>

<h4 id="321-global-scope">3.2.1. Global Scope</h4>

<h4 id="322-local-scope">3.2.2. Local Scope</h4>

<h3 id="33-mutators--casting">3.3. Mutators &amp; Casting</h3>

<h4 id="331-accessors-mutators">3.3.1. Accessors, Mutators</h4>

<h4 id="332-attribute-casting">3.3.2. Attribute Casting</h4>

<h4 id="333-custom-casts">3.3.3. Custom Casts</h4>

<h3 id="34-eloquent-collections">3.4. Eloquent Collections</h3>

<h4 id="341-collection-methos">3.4.1. Collection Methos</h4>

<h3 id="35-eloquent-serialization">3.5. Eloquent Serialization</h3>

<h4 id="351-to-arrays">3.5.1. To Arrays</h4>

<h4 id="352-to-json">3.5.2. To JSON</h4>

<h3 id="36-eloquent-relationships">3.6. Eloquent Relationships</h3>

<h3 id="37-manipulation-of-relationships">3.7. Manipulation of Relationships</h3>

<h3 id="38-eager-loading">3.8. Eager Loading</h3>

<h4 id="381-constraining-eager-loads">3.8.1. Constraining Eager Loads</h4>

<h4 id="382-lazy-eager-loading">3.8.2. Lazy Eager Loading</h4>

<h4 id="383-preventing-lazy-loading">3.8.3. Preventing Lazy Loading</h4>

<h3 id="39-eloquent-events">3.9. Eloquent Events</h3>

<h3 id="310-test">3.10. Test</h3>

<h2 id="4-reference">4. Reference</h2>
<ul>
  <li>Stauffer, M. (2019). Laravel: Up &amp; Running: A Framework for Building Modern PHP Apps. United States: O’Reilly Media.</li>
  <li>https://laravel.com/docs/8.x/queries</li>
  <li>https://laravel.com/docs/8.x/eloquent</li>
</ul>

          <div class="post__tags">
            
              <a href="/tag/laravel">laravel</a>
            
              <a href="/tag/db">db</a>
            
              <a href="/tag/sql">sql</a>
            
              <a href="/tag/query builder">query builder</a>
            
              <a href="/tag/eloquent">eloquent</a>
            
          </div>
        </div>

        <hr>

        
          <div class="box box--author">

  
  <figure class="author-image">
    <div class="img" style="background-image: url(https://s.gravatar.com/avatar/f456bb14ac63f83dc58bcd02b5ed84bb?s=150)">
      <span class="hidden">Ben Hu's Picture</span>
    </div>
  </figure>
  

  <div class="box__body">

    <h4 class="box__title">
      Ben Hu
    </h4>

    
    <p class="box__text">A web App developer and a cloud infrastructure enthusiast. Formerly a petroleum geologist.</p>
    

    <div class="author-meta box__text">
      
      <div class="author-link inline-block">
        <a href="https://ben.seedme.app">
          <span data-icon="ei-link" data-size="s"></span>
        </a>
      </div>
      

      
      <div class="author-link inline-block">
        <a href="http://www.twitter.com/benuoa" target="_blank">
          <span data-icon="ei-sc-twitter" data-size="s"></span>
        </a>
      </div>
      

      
      <div class="author-link inline-block">
        <a href="http://www.github.com/benjaminv" target="_blank">
          <span data-icon="ei-sc-github" data-size="s"></span>
        </a>
      </div>
      

      
      <div class="author-link inline-block">
        <a href="mailto:i@seedme.app" target="_blank">
          <span data-icon="ei-envelope" data-size="s"></span>
        </a>
      </div>
      
    </div>

  </div><!-- box__body -->

</div><!-- box -->
        

        

<ul class="share-list">
  <li>
    <a class="share-list__link" href="https://twitter.com/intent/tweet?text=Laravel Database Raw SQL, Query Builder and Eloquent ORM&url=http://localhost:4000/2021/08/07/laravel-db-raw-SQL-query-builder-and-eloquent/&via=benuoa&related=benuoa" rel="nofollow" target="_blank" title="Share on Twitter">
      <div data-icon="ei-sc-twitter" data-size="s" class="share-list__icon share-list__icon--twitter"></div>
    </a>
  </li>
  <li>
    <a class="share-list__link" href="https://facebook.com/sharer.php?u=http://localhost:4000/2021/08/07/laravel-db-raw-SQL-query-builder-and-eloquent/" rel="nofollow" target="_blank" title="Share on Facebook">
    <div data-icon="ei-sc-facebook" data-size="s" class="share-list__icon share-list__icon--facebook"></div>
    </a>
  </li>
  <li>
    <a class="share-list__link" href="https://plus.google.com/share?url=http://localhost:4000/2021/08/07/laravel-db-raw-SQL-query-builder-and-eloquent/" rel="nofollow" target="_blank" title="Share on Google+">
    <div data-icon="ei-sc-google-plus" data-size="s" class="share-list__icon share-list__icon--google"></div>
    </a>
  </li>
</ul>

        <h5 class="separator">
  <span class="separator__title">Newsletter</span>
</h5>

<div class="box box--news-letter">
  <form action="//seedme.us17.list-manage.com/subscribe/post?u=4ef5ef6bfa483c6518fd064f6&amp;id=4e9fedb958" method="post" target="_blank">
    <div class="row">
      <div class="column medium-9 large-9">
        <input type="email" name="EMAIL" placeholder="Your email address">
      </div>
      <div class="column medium-3 large-3">
        <input type="submit" class="button button--expand" value="SIGN UP">
      </div>
    </div>
  </form>
</div>

        <section class="disqus">
  <h5 class="separator">
    <span class="separator__title">Comments</span>
  </h5>
  <div id="disqus_thread"></div>

<script>
  var disqus_config = function () {
    this.page.url = "http://localhost:4000/2021/08/07/laravel-db-raw-SQL-query-builder-and-eloquent/";
  };

  (function() {
    var d = document, s = d.createElement('script');

    s.src = '//ben-hu.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</section>
      </article>
    </div>

  </div> <!-- row-->
</div> <!-- wrapper -->
  </div>

  <script src="/js/jquery-2.1.4.min.js"></script>
  <script src="/js/evil-icons.min.js"></script>
  <script src="/js/jquery.fitvids.js"></script>
  <script src="/js/jquery.ghostHunter.min.js"></script>
  <script src="/js/script.js"></script>
</body>

</html>